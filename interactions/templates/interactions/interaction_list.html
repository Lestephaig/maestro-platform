{% extends "interactions/base_interactions.html" %}
{% load interaction_extras %}

{% block interactions_content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="h3 mb-1 text-light">Мои проекты</h1>
        <p class="mb-0 text-subtle">Все проекты и сделки, в которых вы участвуете.</p>
    </div>
    <a href="{% url 'interactions:create' %}" class="btn btn-warning fw-bold">
        <i class="bi bi-plus-circle me-2"></i>Новый проект
    </a>
</div>

{% if project_entries %}
    <div class="list-group">
        {% for entry in project_entries %}
            {% with interaction=entry.interaction participants=entry.participants %}
            <a href="{% url 'interactions:detail' interaction.pk %}" class="list-group-item list-group-item-action bg-dark text-light mb-3 rounded">
                <div class="d-flex w-100 justify-content-between">
                    <h5 class="mb-1">{{ interaction.title }}</h5>
                    <small class="text-muted">{{ interaction.created_at|date:"d.m.Y" }}</small>
                </div>
                <p class="mb-1 text-muted">{{ interaction.get_interaction_type_display }}</p>
                <div class="d-flex flex-wrap gap-3 small text-subtle">
                    <span><i class="bi bi-flag me-1"></i>{{ interaction.get_status_display }}</span>
                    {% with agent_list=interaction|participants_by_role:'agent' %}
                        {% if agent_list %}
                            <span><i class="bi bi-person-badge me-1"></i>
                                {% for participant in agent_list %}
                                    {{ participant.display_name }}{% if participant.status == 'pending' %} (ожидание){% elif participant.status == 'declined' %} (отклонено){% endif %}{% if not forloop.last %}, {% endif %}
                                {% endfor %}
                            </span>
                        {% endif %}
                    {% endwith %}
                    {% with venue_list=interaction|participants_by_role:'venue' %}
                        {% if venue_list %}
                            <span><i class="bi bi-building me-1"></i>
                                {% for participant in venue_list %}
                                    {{ participant.display_name }}{% if participant.status == 'pending' %} (ожидание){% elif participant.status == 'declined' %} (отклонено){% endif %}{% if not forloop.last %}, {% endif %}
                                {% endfor %}
                            </span>
                        {% endif %}
                    {% endwith %}
                    {% with performer_list=interaction|participants_by_role:'performer' %}
                        {% if performer_list %}
                            <span><i class="bi bi-mic me-1"></i>
                                {% for participant in performer_list %}
                                    {{ participant.display_name }}{% if participant.status == 'pending' %} (ожидание){% elif participant.status == 'declined' %} (отклонено){% endif %}{% if not forloop.last %}, {% endif %}
                                {% endfor %}
                            </span>
                        {% endif %}
                    {% endwith %}
                </div>
            </a>
            {% endwith %}
        {% endfor %}
    </div>
{% else %}
    <div class="text-center py-5 bg-dark rounded" style="color: rgba(255,255,255,0.75);">
        <i class="bi bi-kanban" style="font-size: 3rem;"></i>
        <p class="mt-3 mb-0">У вас пока нет проектов. Создайте первый, чтобы начать работу над сотрудничеством.</p>
    </div>
{% endif %}
<style>
    .text-subtle {
        color: rgba(255, 255, 255, 0.72);
    }
    .list-group-item-action:hover {
        color: #f1f2f6;
    }
</style>
{% endblock %}

