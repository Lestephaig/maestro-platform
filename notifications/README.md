# Система уведомлений

Система автоматических email уведомлений для Maestro Platform.

## Типы уведомлений

### 1. Новое сообщение в чате
- **Триггер**: Сообщение не прочитано в течение 5 минут
- **Получатель**: Пользователь, которому адресовано сообщение
- **Содержание**: Имя отправителя, первые 100 символов сообщения, ссылка на чат

### 2. Приглашение в проект
- **Триггер**: Создание нового `InteractionParticipant` со статусом `pending`
- **Получатель**: Приглашенный пользователь
- **Содержание**: Название проекта, роль, имя пригласившего, ссылка на проект

### 3. Изменение статуса проекта
- **Триггер**: Изменение статуса проекта (`Interaction.status`)
- **Получатель**: Все участники проекта (кроме создателя, если он сам изменил статус)
- **Содержание**: Название проекта, старый и новый статус, ссылка на проект

### 4. Завершение проекта
- **Триггер**: Статус проекта изменен на `completed`
- **Получатель**: Все участники проекта
- **Содержание**: Название проекта, уведомление о завершении, ссылка на проект

## Настройка

### Периодическая проверка непрочитанных сообщений

Для работы уведомлений о непрочитанных сообщениях нужно запускать периодическую задачу:

```bash
python manage.py check_unread_messages
```

**Рекомендуется настроить cron или планировщик задач:**

#### Windows (Task Scheduler)
Создайте задачу, которая запускается каждые 5 минут:
```
python C:\path\to\maestro-platform\manage.py check_unread_messages
```

#### Linux/Mac (cron)
Добавьте в crontab:
```bash
*/5 * * * * cd /path/to/maestro-platform && python manage.py check_unread_messages
```

#### Альтернатива: Django-Q или Celery
Для более продвинутого управления задачами можно использовать:
- **Django-Q**: Простая система очередей для Django
- **Celery**: Мощная система распределенных задач

## Структура

- `models.py` - Модель Notification для отслеживания отправленных уведомлений
- `utils.py` - Утилиты для отправки email уведомлений
- `signals.py` - Django сигналы для автоматических уведомлений
- `management/commands/check_unread_messages.py` - Команда для проверки непрочитанных сообщений
- `templates/notifications/emails/` - Шаблоны email уведомлений

## Защита от дубликатов

Система автоматически предотвращает отправку дубликатов:
- Для одного объекта не отправляется более одного уведомления в течение часа
- Уведомления сохраняются в БД для отслеживания

