{% extends 'base.html' %}

{% block title %}Доска объявлений - Maestro Platform{% endblock %}

{% block extra_css %}
<style>
    .announcements-content {
        padding: 2rem 0 3rem;
        background: linear-gradient(135deg, var(--gray-dark) 0%, var(--black) 100%);
        min-height: calc(100vh - 200px);
    }
    
    .page-header {
        text-align: center;
        margin-bottom: 3rem;
        padding-top: 2rem;
    }
    
    .page-header h1 {
        background: linear-gradient(135deg, var(--gold-light), var(--gold));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-size: 2.5rem;
        font-weight: 800;
        margin-bottom: 1rem;
    }
    
    .filter-bar {
        background: linear-gradient(135deg, var(--gray) 0%, var(--gray-dark) 100%);
        border-radius: 15px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        border: 2px solid var(--silver-dark);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }
    
    .filter-bar .form-check {
        margin: 0;
        padding: 0;
        display: flex;
        align-items: center;
        height: 100%;
        min-height: 38px;
    }
    
    .filter-bar .form-check-label {
        margin-left: 0.5rem;
        margin-bottom: 0;
    }
    
    .filter-bar .form-check-input {
        margin-top: 0;
        flex-shrink: 0;
    }
    
    .filter-bar h5 {
        color: var(--gold);
        margin-bottom: 1rem;
        font-weight: 700;
    }
    
    .announcements-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 2rem;
        margin-bottom: 2rem;
    }
    
    .announcement-card {
        background: linear-gradient(135deg, var(--gray) 0%, var(--gray-dark) 100%);
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 10px 35px rgba(0, 0, 0, 0.5);
        border: 2px solid var(--silver-dark);
        transition: all 0.4s ease;
        text-decoration: none;
        color: inherit;
        display: flex;
        flex-direction: column;
        position: relative;
    }
    
    .announcement-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(212, 175, 55, 0.1), transparent);
        transition: left 0.6s ease;
    }
    
    .announcement-card:hover::before {
        left: 100%;
    }
    
    .announcement-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 25px 50px rgba(212, 175, 55, 0.4);
        border-color: var(--gold);
        text-decoration: none;
        color: inherit;
    }
    
    .announcement-header {
        padding: 1.5rem;
        border-bottom: 1px solid var(--silver-dark);
    }
    
    .announcement-type-badge {
        display: inline-flex;
        align-items: center;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        line-height: 1.2;
        height: 1.75rem;
    }
    
    .announcement-type-badge.need_performer {
        background: linear-gradient(135deg, rgba(74, 144, 226, 0.3), rgba(74, 144, 226, 0.2));
        color: var(--blue-accent);
        border: 1px solid var(--blue-accent);
    }
    
    .announcement-type-badge.need_venue {
        background: linear-gradient(135deg, rgba(212, 175, 55, 0.3), rgba(212, 175, 55, 0.2));
        color: var(--gold);
        border: 1px solid var(--gold);
    }
    
    .announcement-type-badge.collaboration {
        background: linear-gradient(135deg, rgba(46, 204, 113, 0.3), rgba(46, 204, 113, 0.2));
        color: #2ecc71;
        border: 1px solid #2ecc71;
    }
    
    .announcement-type-badge.audition {
        background: linear-gradient(135deg, rgba(155, 89, 182, 0.3), rgba(155, 89, 182, 0.2));
        color: #9b59b6;
        border: 1px solid #9b59b6;
    }
    
    .announcement-type-badge.contest {
        background: linear-gradient(135deg, rgba(241, 196, 15, 0.3), rgba(241, 196, 15, 0.2));
        color: #f1c40f;
        border: 1px solid #f1c40f;
    }
    
    .announcement-type-badge.other {
        background: linear-gradient(135deg, rgba(192, 192, 192, 0.3), rgba(192, 192, 192, 0.2));
        color: var(--silver);
        border: 1px solid var(--silver);
    }
    
    .announcement-title {
        color: var(--white);
        font-size: 1.3rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        line-height: 1.3;
    }
    
    .announcement-body {
        padding: 1.5rem;
        flex: 1;
        display: flex;
        flex-direction: column;
    }
    
    .announcement-description {
        color: var(--silver-light);
        font-size: 0.95rem;
        line-height: 1.6;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        margin-bottom: 1rem;
        flex: 1;
    }
    
    .announcement-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
        margin-bottom: 1rem;
        font-size: 0.85rem;
        color: var(--silver);
    }
    
    .announcement-meta-item {
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }
    
    .announcement-meta-item i {
        color: var(--gold);
    }
    
    .announcement-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 1rem;
    }
    
    .announcement-tag {
        padding: 0.25rem 0.5rem;
        background: rgba(212, 175, 55, 0.1);
        border: 1px solid rgba(212, 175, 55, 0.3);
        border-radius: 12px;
        font-size: 0.75rem;
        color: var(--gold-light);
    }
    
    .announcement-footer {
        padding: 1rem 1.5rem;
        background: rgba(0, 0, 0, 0.3);
        border-top: 1px solid var(--silver-dark);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .announcement-author {
        color: var(--silver);
        font-size: 0.85rem;
    }
    
    .announcement-responses {
        color: var(--gold);
        font-size: 0.85rem;
        font-weight: 600;
    }
    
    .deadline-soon {
        color: #ff6b6b !important;
        font-weight: 700;
    }
    
    .status-badge {
        display: inline-flex;
        align-items: center;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        line-height: 1.2;
        height: 1.75rem;
    }
    
    .status-badge.published {
        background: rgba(46, 204, 113, 0.2);
        color: #2ecc71;
        border: 1px solid #2ecc71;
    }
    
    .status-badge.completed {
        background: rgba(46, 204, 113, 0.2);
        color: #2ecc71;
        border: 1px solid #2ecc71;
    }
    
    .status-badge.draft {
        background: rgba(192, 192, 192, 0.2);
        color: var(--silver);
        border: 1px solid var(--silver);
    }
    
    .status-badge.archived {
        background: rgba(149, 165, 166, 0.2);
        color: #95a5a6;
        border: 1px solid #95a5a6;
    }
    
    .btn-create {
        background: linear-gradient(135deg, var(--gold-dark), var(--gold));
        border: none;
        color: var(--black);
        font-weight: 700;
        padding: 0.75rem 2rem;
        border-radius: 25px;
        transition: all 0.3s ease;
    }
    
    .btn-create:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(212, 175, 55, 0.5);
        color: var(--black);
    }
</style>
{% endblock %}

{% block content %}
<div class="announcements-content">
    <div class="container">
        {% if user.is_authenticated %}
        <div class="page-header">
            <a href="{% url 'announcements:create' %}" class="btn btn-create">
                <i class="bi bi-plus-circle"></i> Создать объявление
            </a>
        </div>
        {% endif %}
        
        <!-- Фильтры -->
        <div class="filter-bar">
            <h5><i class="bi bi-funnel-fill"></i> Фильтры</h5>
            <form method="get" class="row g-2">
                <div class="col-md-1">
                    <input type="text" name="q" class="form-control" placeholder="Поиск..." value="{{ search_query }}">
                </div>
                <div class="col-md-2">
                    <select name="type" class="form-select">
                        <option value="">Все типы</option>
                        {% for value, label in announcement_types %}
                        <option value="{{ value }}" {% if announcement_type == value %}selected{% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-2">
                    <select name="tag" class="form-select">
                        <option value="">Все теги</option>
                        {% for tag in all_tags %}
                        <option value="{{ tag.slug }}" {% if tag_slug == tag.slug %}selected{% endif %}>{{ tag.name }} ({{ tag.announcement_count }})</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-2">
                    <input type="text" name="location" class="form-control" placeholder="Локация" value="{{ location_query }}">
                </div>
                <div class="col-md-1">
                    <select name="is_online" class="form-select">
                        <option value="">Все</option>
                        <option value="true" {% if is_online == 'true' %}selected{% endif %}>Онлайн</option>
                        <option value="false" {% if is_online == 'false' %}selected{% endif %}>Офлайн</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <div class="form-check d-flex align-items-center h-100" style="gap: 1.5rem; justify-content: flex-start;">
                        <label class="form-check-label" for="available_only" style="color: var(--gold); font-size: 0.9rem; white-space: nowrap; margin-bottom: 0; flex-shrink: 0; margin-right: 0.5rem;">
                            Доступно
                        </label>
                        <input class="form-check-input" type="checkbox" name="available_only" value="true" id="available_only" style="flex-shrink: 0; margin-left: 0;" {% if available_only == 'true' %}checked{% endif %}>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="btn-group w-100" role="group">
                        <button type="submit" class="btn btn-outline-light"><i class="bi bi-search"></i> Применить</button>
                        <a href="{% url 'announcements:list' %}" class="btn btn-outline-secondary"><i class="bi bi-x-circle"></i></a>
                    </div>
                </div>
            </form>
        </div>
        
        <!-- Список объявлений -->
        {% if announcements %}
        <div class="announcements-grid">
            {% for announcement in announcements %}
            <a href="{% url 'announcements:detail' announcement.id %}" class="announcement-card">
                <div class="announcement-header">
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem; flex-wrap: wrap;">
                        <span class="announcement-type-badge {{ announcement.announcement_type }}">
                            {{ announcement.get_announcement_type_display }}
                        </span>
                        <span class="status-badge {{ announcement.status }}">
                            {{ announcement.get_status_display }}
                        </span>
                    </div>
                    <h3 class="announcement-title">{{ announcement.title }}</h3>
                </div>
                <div class="announcement-body">
                    <p class="announcement-description">{{ announcement.description|truncatewords:30 }}</p>
                    
                    <div class="announcement-meta">
                        {% if announcement.start_date %}
                        <div class="announcement-meta-item">
                            <i class="bi bi-calendar-event"></i>
                            <span>
                                {% if announcement.is_one_day %}
                                    {{ announcement.start_date|date:"d.m.Y" }}
                                {% else %}
                                    {{ announcement.start_date|date:"d.m.Y" }}{% if announcement.end_date %} - {{ announcement.end_date|date:"d.m.Y" }}{% endif %}
                                {% endif %}
                            </span>
                        </div>
                        {% endif %}
                        {% if announcement.city or announcement.location %}
                        <div class="announcement-meta-item">
                            <i class="bi bi-geo-alt"></i>
                            <span>
                                {% if announcement.city %}{{ announcement.city }}{% endif %}
                                {% if announcement.city and announcement.location %}, {% endif %}
                                {% if announcement.location %}{{ announcement.location }}{% endif %}
                            </span>
                        </div>
                        {% endif %}
                        {% if announcement.is_online %}
                        <div class="announcement-meta-item">
                            <i class="bi bi-wifi"></i>
                            <span>Онлайн</span>
                        </div>
                        {% endif %}
                        {% if announcement.budget_amount %}
                        <div class="announcement-meta-item">
                            <i class="bi bi-cash-coin"></i>
                            <span>{{ announcement.budget_amount|floatformat:0 }} {{ announcement.get_budget_currency_display }}</span>
                        </div>
                        {% endif %}
                        {% if announcement.application_deadline %}
                        <div class="announcement-meta-item {% if announcement.is_deadline_soon %}deadline-soon{% endif %}">
                            <i class="bi bi-calendar-date"></i>
                            <span>До {{ announcement.application_deadline|date:"d.m.Y" }}</span>
                        </div>
                        {% endif %}
                    </div>
                    
                    {% if announcement.tags.all %}
                    <div class="announcement-tags">
                        {% for tag in announcement.tags.all|slice:":3" %}
                        <span class="announcement-tag">{{ tag.name }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                <div class="announcement-footer">
                    <span class="announcement-author">
                        <i class="bi bi-person-circle"></i> {{ announcement.author.username }}
                    </span>
                    <span class="announcement-responses">
                        <i class="bi bi-chat-dots"></i> {{ announcement.responses_count|default:announcement.response_count }} откликов
                    </span>
                </div>
            </a>
            {% endfor %}
        </div>
        
        <!-- Пагинация -->
        {% if page_obj.has_other_pages %}
        <nav aria-label="Навигация по страницам">
            <ul class="pagination justify-content-center">
                {% if page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page=1{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.type %}&type={{ request.GET.type }}{% endif %}">&laquo; Первая</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.type %}&type={{ request.GET.type }}{% endif %}">Предыдущая</a>
                </li>
                {% endif %}
                
                <li class="page-item active">
                    <span class="page-link">{{ page_obj.number }} из {{ page_obj.paginator.num_pages }}</span>
                </li>
                
                {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.type %}&type={{ request.GET.type }}{% endif %}">Следующая</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.type %}&type={{ request.GET.type }}{% endif %}">Последняя &raquo;</a>
                </li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}
        
        {% else %}
        <div class="text-center py-5">
            <i class="bi bi-inbox" style="font-size: 4rem; color: var(--silver);"></i>
            <h3 class="mt-3" style="color: var(--silver);">Объявления не найдены</h3>
            <p style="color: var(--silver);">Попробуйте изменить параметры фильтрации</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

